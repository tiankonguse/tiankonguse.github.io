---
layout: post  
title: 为NC攀岩馆降本增效，网站降低成本85%  
description: 分析了一下攀岩馆的成本，发现至少可以降低 85%。  
keywords: 技术  
tags: [技术]  
categories: [技术]  
updateDate: 2025-01-02 21:13:00  
published: true  
---


## 零、背景  


在 2023 年年初，我曾给 NC 攀岩馆修复过小程序，记录在《[NC 攀岩馆的小程序挂了](https://mp.weixin.qq.com/s/H7325ReMp3OgVav408bNQw)》。  


2024年末， NC 攀岩馆的小程序又挂了。  
而且简单沟通，还发现这个小程序加后台服务器，每月有 403 元的成本，攀岩馆的海涛老板表示这个成本太贵了，都不想续费了。  


所以我就重新 Review 了一下这个小程序与后台的架构，看能不能降低下成本，并顺手修复下小程序挂掉的问题。  


## 一、架构分析  


NC 攀岩馆小程序的架构比较简单，如下图。  


![](https://res2025.tiankonguse.com/images/2025/01/02/001.png)  

 
小程序通过https域名与网关负载均衡 CLB 访问后台。  
CLB 正常的功能是负载均衡，不过这里主要是为了实现免费 HTTPS，后台实际只有一个服务器。  
后台服务器统一通过 NGINX 来分发流量。  
静态数据直接分发，动态数据转发给 JAVA 服务。  
JAVA 服务使用的数据库是 MONGODB， 是自己部署的。  


## 二、成本分析  


腾讯云最近2个月每月成本都是 403 元左右，主要在 CLB 负载均衡和服务器上。  


CLB 负载均衡 142.2元/月  
服务器 261.5元/月  


显然，CLB 负载均衡可以干掉，成本从142.2元/月 降低到 0 元/月。  
对于服务器，目前配置是 2核4G，可以降到1核1G，成本从261.5元/月 降低到 60元/月（购买最低配的价格）。  


这样算下来，就可以把每月成本 403元 降低到 60元，成本降低 85%，每月预估降低 334 元。  


## 三、方案执行  


**删除 CLB**  


小程序挂的原因也是由于 CLB 的域名过期了，CLB 已经不可用了。  
所有现在可以直接把 CLB 删除，从而马上每月节省 142.2元。  


**缩容缩配**


服务器从 2核4G 降低到 1核1G时，发现价格竟然不是 60元，而是124.5 元。  


![](https://res2025.tiankonguse.com/images/2025/01/02/002.png)  



先不管那么多了，先降低配额再说。  


降配之后，立马退还了110.05元。  


![](https://res2025.tiankonguse.com/images/2025/01/02/003.png)  



**优化总结**  


到目前为止，删除了 CLB 与降配了服务器，每月成本从 403元 降低到了 124.5元，降低了 70%。。  



## 四、项目总结  


为何原先规划的是成本降低 85%，实际却只降低了 70%呢？  


通过对比购买新服务器与已有服务器的配置，发现是机型的问题。  
比较麻烦的是，降配不支持切换机型。  
那只能购买新的服务器，然后把旧服务器的数据迁移过去，挺麻烦的。  


海涛说这个服务器已经续费了，以后再找时间买新的服务器，然后再进去迁移吧。  
PS：其实什么时候买都一样的，数据迁移之后，删除服务器，会按天进行折算退还剩余的钱的。  


老板都发话了，那 NC 攀岩馆的降本增效就算临时结项了。  
原先成本 403元，降低到 124.5元，降低了 70%，每月节省 278.5元钱。  


## 五、最后  


什么，好像小程序挂了还没修复呢。  


根本原因是 https 失效了，可以使用 acme.sh 申请一个免费域名。  
于是我去研究了下 acme.sh， 把域名这个事情搞定了。 


修复前，我先测试了下 NC攀岩馆的小程序，确实是不可用。  
修复后，我再测试了下 NC攀岩馆的小程序，确实可以使用了。  


看来就是 https 证书的问题，这里也算是永远把证书的问题搞定了。  


对于后面服务器迁移的事，这个可以简单迁移，也可以工具迁移。  
我都打算试试，所以后面需要迁移了，我操作后再单独记录一篇文章。  


《完》  


-EOF-  

本文公众号：天空的代码世界  
个人微信号： tiankonguse  
公众号ID： tiankonguse-code  
  